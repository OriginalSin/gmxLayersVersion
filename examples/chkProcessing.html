<!DOCTYPE html>
<html>
<head>
	<title>GeoMixer Vector Layer Example</title>
	<meta charset="utf-8" />
    <style>
        html, body, #map {
            height: 100%;
            margin: 0px;
        }

        #infoPanel {
            position: absolute;
			left: 0px;
			right: 0px;
			top: 21px;
            text-align: center;
			z-index: 1;
        }

        #info {
			background-color: #ffffff;
			border-radius: 5px;
            box-shadow: 0 1px 7px rgba(0,0,0,0.65);
            padding: 10px;
        }

        #controls {
            position: absolute;
			left: 54px;
			top: 50px;
			z-index: 1;
			background-color: #ffffff;
			border-radius: 5px;
            box-shadow: 0 1px 7px rgba(0,0,0,0.65);
        }
        
        #controls button {
            border-radius: 5px;
            
        }
        
        #controls > div{
            padding: 6px;
        }
    </style>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
	<script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet-src.js"></script>

	<script src="http://scanex.github.io/Leaflet-GeoMixer/build/leaflet-geomixer-dev.js?key=U92596WMIH"></script>

	<script src="../src/gmxWorkerManager.js"></script>
	<script src="../src/gmxLayersVersion.js"></script>
</head>
<body>
	<div id="map"></div>
     <div id="infoPanel">
        <span id="info">
                Processing test <button id="Updated">Updated</button> <button id="Inserted">Inserted</button> <button id="Deleted">Deleted</button>
        </span>
    </div>

	<script>
		var map = L.map('map').setView([58.998438, 49.775619], 2);

		var osm = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
			maxZoom: 18,
			attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'
		});

        L.gmx.loadLayers([
            {mapID: 'UIRCQ', layerID: 'B0A30EF77D7F4182B302B9F7CB83CA25'}
        ]).then(function(testLayer) {
            osm.addTo(map);
            testLayer.addTo(map);
            
            var baseLayers = {
                OSM: osm
            }, overlays = {
                TestLayer: testLayer
            }; 

            L.control.layers(baseLayers, overlays, {collapsed: false}).addTo(map);

            document.getElementById("Updated").onclick = function() {
                var it = {"Status":"ok","Result":[{"properties":{"Access":"edit","name":"B0A30EF77D7F4182B302B9F7CB83CA25","title":"test4List","description":"","Owner":"LayerManager","LayerVersion":709,"LayerID":"B0A30EF77D7F4182B302B9F7CB83CA25","type":"Vector","EncodeSource":null,"VtMinZoom":1,"VtMaxZoom":1,"MinZoom":1,"MaxZoom":1,"date":"27.02.2013","Copyright":"","Legend":null,"MetaProperties":{"shiftX":{"Type":"String","Value":"0"},"shiftY":{"Type":"String","Value":"0"},"test":{"Type":"String","Value":"23"},"dxfxc":{"Type":"String","Value":"2"},"multiFilters":{"Type":"String","Value":"0"}},"identityField":"ogc_fid","NameObject":"","tiles":[-1,-1,1,-1,0,1,0,-1,1,0,0,1],"tilesVers":[656,664,656,667],"Processing":{"Updated":[{"id":2,"properties":{"ogc_fid":"2","t1":"kk","t2":"12345"},"geometry":{"type":"POLYGON","coordinates":[[[9960050.53,9392582.0399217978],[5792092.26,7983694.7297642715],[3735426.78,5165920.11856702],[8296780.7981861718,5420302.5484396173],[9960050.53,9392582.0399217978]]]}}]},"GeometryType":"polygon","attributes":["t1","t2"],"attrTypes":["string","float"]},"geometry":{"type":"POLYGON","coordinates":[[[-352221.83,-195022.72],[-352221.83,10977580.254098354],[11055851.771167895,10977580.254098354],[11055851.771167895,-195022.72],[-352221.83,-195022.72]]]}}],"CallbackName":"gmxAPI_id15"};
                testLayer.updateVersion(it.Result[0]);
            }

            document.getElementById("Inserted").onclick = function() {
                var it = {"Status":"ok","Result":[{"properties":{"Access":"edit","name":"B0A30EF77D7F4182B302B9F7CB83CA25","title":"test4List","description":"","Owner":"LayerManager","LayerVersion":709,"LayerID":"B0A30EF77D7F4182B302B9F7CB83CA25","type":"Vector","EncodeSource":null,"VtMinZoom":1,"VtMaxZoom":1,"MinZoom":1,"MaxZoom":1,"date":"27.02.2013","Copyright":"","Legend":null,"MetaProperties":{"shiftX":{"Type":"String","Value":"0"},"shiftY":{"Type":"String","Value":"0"},"test":{"Type":"String","Value":"23"},"dxfxc":{"Type":"String","Value":"2"},"multiFilters":{"Type":"String","Value":"0"}},"identityField":"ogc_fid","NameObject":"","tiles":[-1,-1,1,-1,0,1,0,-1,1,0,0,1],"tilesVers":[656,664,656,667],"Processing":{"Inserted":[{"id":5,"properties":{"ogc_fid":"5","t1":"123","t2":"123"},"geometry":{"type":"POLYGON","coordinates":[[[3111292.7993198144,10977580.254098354],[11055851.771167895,10977580.254098354],[11055851.771167895,7240115.3186942609],[3111292.7993198144,7240115.3186942609],[3111292.7993198144,10977580.254098354]]]}}]},"GeometryType":"polygon","attributes":["t1","t2"],"attrTypes":["string","float"]},"geometry":{"type":"POLYGON","coordinates":[[[-352221.83,-195022.72],[-352221.83,10977580.254098354],[11055851.771167895,10977580.254098354],[11055851.771167895,-195022.72],[-352221.83,-195022.72]]]}}],"CallbackName":"gmxAPI_id11"};
                testLayer.updateVersion(it.Result[0]);
            }
            document.getElementById("Deleted").onclick = function() {
                var it = {"Status":"ok","Result":[{"properties":{"Access":"edit","name":"B0A30EF77D7F4182B302B9F7CB83CA25","title":"test4List","description":"","Owner":"LayerManager","LayerVersion":709,"LayerID":"B0A30EF77D7F4182B302B9F7CB83CA25","type":"Vector","EncodeSource":null,"VtMinZoom":1,"VtMaxZoom":1,"MinZoom":1,"MaxZoom":1,"date":"27.02.2013","Copyright":"","Legend":null,"MetaProperties":{"shiftX":{"Type":"String","Value":"0"},"shiftY":{"Type":"String","Value":"0"},"test":{"Type":"String","Value":"23"},"dxfxc":{"Type":"String","Value":"2"},"multiFilters":{"Type":"String","Value":"0"}},"identityField":"ogc_fid","NameObject":"","tiles":[-1,-1,1,-1,0,1,0,-1,1,0,0,1],"tilesVers":[656,664,656,667],"Processing":{"Deleted":[5]},"GeometryType":"polygon","attributes":["t1","t2"],"attrTypes":["string","float"]},"geometry":{"type":"POLYGON","coordinates":[[[-2445984.9051256403,-195022.72],[-2445984.9051256403,10684062.065477882],[10566654.790000001,10684062.065477882],[10566654.790000001,-195022.72],[-2445984.9051256403,-195022.72]]]}}],"CallbackName":"gmxAPI_id6"};
                testLayer.updateVersion(it.Result[0]);
            }
            
        });
	</script>
</body>
</html>